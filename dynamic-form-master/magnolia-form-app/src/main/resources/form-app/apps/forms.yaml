name: forms
class: info.magnolia.ui.contentapp.configuration.ContentAppDescriptor
appClass: info.magnolia.form.app.FormBrowserApp
icon: icon-work-item
permissions:
  roles:
    superuser: superuser
    forms-base: forms-base
subApps:
  browser:
    class: info.magnolia.ui.contentapp.configuration.BrowserDescriptor
    subAppClass: info.magnolia.form.app.FormBrowserSubApp
    closable: false
    datasource:
      $type: dbFormDatasource
      entityName: Form
    actions:
      any-edit:
        $type: openDialogAction
        icon: icon-edit
        implementationClass: info.magnolia.form.action.OpenDynamicallyExistingDialogAction
      refresh:
        icon: icon-rotate-image-cw
        class: info.magnolia.form.action.RefreshDatabaseActionDefinition
        availability:
          root: true
          nodes: false
          rules:
            - name: isFormRoot
              $type: isFormRoot
      confirmDelete:
        icon: icon-delete
        class: info.magnolia.form.action.DeleteDatabaseActionDefinition
        availability:
          root: false
          nodes: true
          multiple: true
      move:
        icon: icon-move
        class: info.magnolia.form.action.MoveActionDefinition
        availability:
          root: false
          nodes: true
          multiple: true
      form-add:
        icon: icon-add-item
        class: info.magnolia.form.action.OpenNewDialogActionDbDefinition
        dialogId: form-app:form-edit
        entityName: Form
        availability:
          root: true
          nodes: true
          multiple: false
      form-edit:
        icon: icon-edit
        $type: openDialogAction
        implementationClass: info.magnolia.form.action.OpenExistingDialogAction
        dialogId: form-app:form-edit
        availability:
          root: false
          nodes: true
          multiple: false
          rules:
            - name: isEntityType
              class: info.magnolia.form.action.availability.EntityTypesAvailableRuleDefinition
              entityTypes:
                - Form
      form-result-details:
        icon: icon-view
        $type: openDetailSubappAction
        appName: forms
        subAppName: result-details
        viewType: view
        availability:
          root: false
          nodes: true
          multiple: false
          rules:
            - name: isEntityType
              class: info.magnolia.form.action.availability.EntityTypesAvailableRuleDefinition
              entityTypes:
                - Form
      form-result-dashboard:
        icon: icon-segmentation
        $type: openDetailSubappAction
        appName: forms
        subAppName: dashboard
        viewType: view
        availability:
          root: false
          nodes: true
          multiple: false
          rules:
            - name: isEntityType
              class: info.magnolia.form.action.availability.EntityTypesAvailableRuleDefinition
              entityTypes:
                - Form

      section-add:
        icon: icon-add-item
        class: info.magnolia.form.action.OpenNewDialogActionDbDefinition
        dialogId: form-app:section-edit
        entityName: Section
        availability:
          root: false
          nodes: true
          multiple: false
          rules:
            - name: isEntityType
              class: info.magnolia.form.action.availability.EntityTypesAvailableRuleDefinition
              entityTypes:
                - Form
      section-edit:
        icon: icon-edit
        $type: openDialogAction
        implementationClass: info.magnolia.form.action.OpenExistingDialogAction
        dialogId: form-app:section-edit
        availability:
          root: false
          nodes: true
          multiple: false
          rules:
            - name: isEntityType
              class: info.magnolia.form.action.availability.EntityTypesAvailableRuleDefinition
              entityTypes:
                - Section

      question-add:
        icon: icon-add-item
        class: info.magnolia.form.action.OpenNewDialogActionDbDefinition
        dialogId: form-app:question-edit
        entityName: Question
        availability:
          root: false
          nodes: true
          multiple: false
          rules:
            - name: isEntityType
              class: info.magnolia.form.action.availability.EntityTypesAvailableRuleDefinition
              entityTypes:
                - Section
                - Form
      question-edit:
        icon: icon-edit
        $type: openDialogAction
        implementationClass: info.magnolia.form.action.OpenExistingDialogAction
        dialogId: form-app:question-edit
        availability:
          root: false
          nodes: true
          multiple: false
          rules:
            - name: isEntityType
              class: info.magnolia.form.action.availability.EntityTypesAvailableRuleDefinition
              entityTypes:
                - Question

      answer-add:
        icon: icon-add-item
        class: info.magnolia.form.action.OpenNewDialogActionDbDefinition
        dialogId: form-app:answer-edit
        entityName: AnswerOption
        availability:
          root: false
          nodes: true
          multiple: false
          rules:
            - name: isEntityType
              class: info.magnolia.form.action.availability.EntityTypesAvailableRuleDefinition
              entityTypes:
                - Question
            - name: isQuestionType
              class: info.magnolia.form.action.availability.QuestionTypesAvailableRuleDefinition
              questionTypes:
                - single
                - multi
      answer-edit:
        icon: icon-edit
        $type: openDialogAction
        implementationClass: info.magnolia.form.action.OpenExistingDialogAction
        dialogId: form-app:answer-edit
        availability:
          root: false
          nodes: true
          multiple: false
          rules:
            - name: isEntityType
              class: info.magnolia.form.action.availability.EntityTypesAvailableRuleDefinition
              entityTypes:
                - AnswerOption

      export:
        icon: icon-export
        $type: exportFormDbAction
        availability:
          root: false
          nodes: true
          multiple: false
          rules:
            - name: isEntityType
              class: info.magnolia.form.action.availability.EntityTypesAvailableRuleDefinition
              entityTypes:
                - Form
                - Section
                - Question
                - AnswerOption

      import:
        icon: icon-import
        $type: openDialogAction
        dialogId: form-app:import
        availability:
          root: true
          rules:
            - name: isEntityType
              class: info.magnolia.form.action.availability.EntityTypesAvailableRuleDefinition
              entityTypes:
                - Form
                - Section
                - Question

    actionbar:
      defaultAction: any-edit
      sections:
        root:
          groups:
            formActions:
              items:
                - name: form-add
                - name: form-edit
                - name: form-result-details
                - name: form-result-dashboard
            sectionActions:
              items:
                - name: section-add
                - name: section-edit
            questionActions:
              items:
                - name: question-add
                - name: question-edit
            answerActions:
              items:
                - name: answer-add
                - name: answer-edit
            refreshAction:
              items:
                - name: refresh
            importExportctions:
              items:
                - name: export
                - name: import
            editActions:
              items:
                - name: confirmDelete
                - name: move
          availability:
            root: true

        multiple:
          groups:
            editActions:
              items:
                - name: confirmDelete
                - name: move
          availability:
            multiple: true


    workbench:

      contentViews:

        - name: tree
          $type: treeView
          multiSelect: true
          dropConstraint:
            $type: formDropConstraint
          columns:

            - name: "title"
              width: 400
              class: info.magnolia.form.column.DbFormsTitleColumnDefinition

            - name: "details"
              width: 800
              class: info.magnolia.form.column.DbFormsDetailsColumnDefinition

            - name: "type"
              width: 400
              class: info.magnolia.form.column.DbFormsTypeColumnDefinition

            - name: "modifiedBy"
              width: 200
              editable: false
              sortable: true

            - name: "modified"
              $type: dateColumn
              width: 220
              editable: false
              sortable: true

            - name: "createdBy"
              width: 200
              editable: false
              sortable: true

            - name: "created"
              $type: dateColumn
              width: 220
              editable: false
              sortable: true

            - name: "empty"
              editable: false
              sortable: false

      extensionViews:
        - name: analytics
          icon: icon-analytics-app
          view:
            name: analytics
            $type: analyticsView
            implementationClass: info.magnolia.form.analytics.DbAnalyticsView
            chartDefinitions:
              - name: formResponseCountByDay
                label: form-app.extensionViews.analytics.formResponseCountByDate.label
                class: info.magnolia.analytics.amcharts.data.AmChartDefinition
                dataSupplier: formResponseCountByDaySupplier
                chartType: !include:/analytics-ui/chartTypes/line-and-area/line-different-colors-ups-downs.yaml
                  series:
                    - name: series
                      dataFields:
                        - name: categoryX
                          jsonPath: $.[*].date
                        - name: valueY
                          jsonPath: $.[*].count
              - name: formResponseCountByForm
                label: form-app.extensionViews.analytics.formResponseCountByForm.label
                class: info.magnolia.analytics.amcharts.data.AmChartDefinition
                dataSupplier: formResponseCountByFormSupplier
                chartType: !include:/analytics-ui/chartTypes/column-and-bar/simple-column.yaml
                  series:
                    - name: series
                      dataFields:
                        - name: categoryX
                          jsonPath: $.[*].title
                        - name: valueY
                          jsonPath: $.[*].count

            dataSuppliers:
              formResponseCountByDaySupplier:
                class: info.magnolia.form.analytics.ResponseCountByDateDataSupplier
                fromDateFormat: yyyyMMdd
                toDateFormat: yyyy-MM-dd
                parameters:
                  startDate: 7DaysAgo
                  endDate: today
              formResponseCountByFormSupplier:
                class: info.magnolia.form.analytics.ResponseCountByFormDataSupplier
                fromDateFormat: yyyyMMdd
                toDateFormat: yyyy-MM-dd

            filterFields:
              - name: startDate
                $type: dateField
                type: java.util.Date
                time: false
                placeholder: Start
                defaultValue: todayMinus7Days
              - name: endDate
                $type: dateField
                type: java.util.Date
                time: false
                placeholder: End
                defaultValue: today

  result-details:
    label: Responses
    class: info.magnolia.ui.contentapp.configuration.BrowserDescriptor
    subAppClass: info.magnolia.form.app.FormDetailResultsBrowserSubApp
    closable: true
    datasource:
      $type: dbFormDatasource
      entityName: Response
    actions:
      refresh:
        icon: icon-rotate-image-cw
        class: info.magnolia.form.action.RefreshDatabaseActionDefinition
        availability:
          root: true
          nodes: false
          rules:
            - name: isFormRoot
              $type: isFormRoot

    actionbar:
      defaultAction: view
      sections:
        root:
          groups:
            refreshAction:
              items:
                - name: refresh
          availability:
            root: true

    workbench:

      contentViews:

        - name: tree
          $type: treeView
          multiSelect: true
          columns:

            - name: "title"
              width: 800
              class: info.magnolia.form.column.DbResultsTitleColumnDefinition
              editable: false
              sortable: true

            - name: "value"
              class: info.magnolia.form.column.DbResultsAnswerColumnDefinition
              width: 400

            - name: "freeTextValue"
              class: info.magnolia.form.column.DbResultsFreeTextValueColumnDefinition

            - name: "empty"
              editable: false
              sortable: false

  dashboard:
    class: info.magnolia.form.analytics.FormResultsSubAppDescriptor
    datasource:
      $type: dbFormDatasource
      entityName: Form
